100 REM Test SAVE SCREEN and LOAD SCREEN

110 QG$="sx"
120 GOSUB _init

130 SCREEN 2,,,,1:RESET PALETTE 0:CLS:SCREEN 3

180 IF QG THEN GOTO _tests
182 PRINT:PRINT $"07"+"WARNING: FLASHING SCREENS"
184 PRINT:PRINT "Press Q to quit, any other key to continue"
186 K=GETKEY:IF K='Q' or K='q' THEN END
188 PRINT:IF QU=0 THEN QL=QL+5

190 _tests

200 GOSUB _title:ARGS "LOAD/SAVE SCREEN/COLOR"

210 GOSUB _nloutput:ARGS "40 Column Screen"
212 FILL BYTES @32,0,32768,0
214 GOSUB _nloutput:ARGS LIST$(NEXT)
215 LOAD "assets/rect40.scrt",@32,0
216 GOSUB _output:ARGS LIST$(NEXT)
217 LOAD "assets/rect40.sclr",@32,1024
218 GOSUB _output:ARGS LIST$(NEXT)
219 LOAD "assets/grays.palt",@32,2048

220 GOSUB _nloutput:ARGS LIST$(NEXT):SCREEN 2
221 CLS:LOAD SCREEN "assets/rect40.scrt"
222 GOSUB _getkey:SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
223 COPY SCREEN CHR TO @33,0
224 SCREEN 3:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,1024)"

230 'GOSUB _nloutput:ARGS LIST$(NEXT):SCREEN 2
231 'LOAD PALETTE 0,"assets/grays.palt"
232 'SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
233 'LOAD SCREEN ATTR "assets/rect40.sclr"
234 'GOSUB _getkey:SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
235 'COPY SCREEN ATTR TO @33,1024
236 'SCREEN 3:GOSUB _assert:ARGS "COMPARE(@32,1024,@33,1024,1024)"

240 GOSUB _nloutput:ARGS LIST$(NEXT)
242 LOAD "assets/rect40.scrp",@32,0
243 GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
244 SCREEN ,,,,0:CLS:LOAD SCREEN "assets/rect40.scrp"
245 GOSUB _getkey:SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
246 COPY SCREEN CHR TO @33,0:V=IN($E0)
247 SCREEN 3:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,1024)"
248 GOSUB _assert:ARGS "(V AND 32)=(PEEK(@32,1024) AND 32)"

250 GOSUB _nloutput:ARGS LIST$(NEXT)
252 LOAD "assets/rect40.scrn",@32,0
253 GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
254 CLS:LOAD SCREEN "assets/rect40.scrn"
255 GOSUB _getkey:SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
256 COPY SCREEN TO @33,0
258 SCREEN 3:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"

290 GOSUB _output:ARGS LIST$(NEXT)
291 SET FILE ERROR OFF:LOAD SCREEN "nofile40.scrn":SET FILE ERROR ON
292 GOSUB _assert:ARGS "ERR=50"


300 GOSUB _nloutput:ARGS LIST$(NEXT):SCREEN 2
301 SAVE SCREEN "work/save40.scrn"
302 GOSUB _assert:ARGS "FILELEN(`work/save40.scrn`)=2048)"
303 SCREEN 3:GOSUB _output:ARGS LIST$(NEXT)
304 FILL BYTES @32,0,16384,0:LOAD "work/save40.scrn",@32,0
305 SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
306 SCREEN ,,,,0:CLS:LOAD SCREEN "work/save40.scrn"
307 GOSUB _getkey:SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
308 COPY SCREEN TO @33,0
310 SCREEN 3:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
318 DEL "work/save40.scrn"

320 GOSUB _nloutput:ARGS LIST$(NEXT):SCREEN 2
321 SAVE SCREEN "work/save40.scrp",PALETTE
322 GOSUB _assert:ARGS "FILELEN(`work/save40.scrp`)=2080)"
323 SCREEN 3:GOSUB _output:ARGS LIST$(NEXT)
324 FILL BYTES @32,0,16384,0:LOAD "work/save40.scrp",@32,0
325 SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
326 SCREEN ,,,,0:CLS:LOAD SCREEN "work/save40.scrp"
327 GOSUB _getkey:SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
328 COPY SCREEN TO @33,0:P$=GETPALETTE$(0)
330 SCREEN 3:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
332 GOSUB _assert:ARGS "P$=PEEK$(@32,2048,32)"
338 DEL "work/save40.scrp"

340 GOSUB _nloutput:ARGS LIST$(NEXT):SCREEN 2
341 SAVE SCREEN "work/save40.scrm",BORDERMAP
342 GOSUB _assert:ARGS "FILELEN(`work/save40.scrm`)=2049)"
343 SCREEN 3:GOSUB _output:ARGS LIST$(NEXT)
344 FILL BYTES @32,0,16384,0:LOAD "work/save40.scrm",@32,0
345 SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
346 SCREEN ,,,,0:CLS:LOAD SCREEN "work/save40.scrm"
347 GOSUB _getkey:SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
348 COPY SCREEN TO @33,0:P$=GETPALETTE$(0):V=IN($E0)
350 SCREEN 3:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
354 GOSUB _assert:ARGS "(V AND 32)=(PEEK(@32,2048) AND 32)"
358 DEL "work/save40.scrm"

360 GOSUB _nloutput:ARGS LIST$(NEXT):SCREEN 2
361 SAVE SCREEN "work/save40.scrb",PALETTE,BORDERMAP
362 GOSUB _assert:ARGS "FILELEN(`work/save40.scrb`)=2081)"
363 SCREEN 3:GOSUB _output:ARGS LIST$(NEXT)
364 FILL BYTES @32,0,16384,0:LOAD "work/save40.scrb",@32,0
365 SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
366 SCREEN ,,,,0:CLS:LOAD SCREEN "work/save40.scrb"
367 GOSUB _getkey:SCREEN 3:GOSUB _output:ARGS LIST$(NEXT):SCREEN 2
368 COPY SCREEN TO @33,0:P$=GETPALETTE$(0):V=IN($E0)
370 SCREEN 3:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
372 GOSUB _assert:ARGS "P$=PEEK$(@32,2048,32)"
374 GOSUB _assert:ARGS "(V AND 32)=(PEEK(@32,2080) AND 32)"
378 DEL "work/save40.scrb"


400 SWAP SCREEN:SCREEN ,,,,1:RESET PALETTE 0:CLS:SWAP SCREEN

410 GOSUB _nloutput:ARGS "80 Column Screen"
412 FILL BYTES @32,0,32768,0
414 GOSUB _nloutput:ARGS LIST$(NEXT)
415 LOAD "assets/rect80.scrt",@32,0
416 GOSUB _output:ARGS LIST$(NEXT)
417 LOAD "assets/rect80.sclr",@32,2048
418 GOSUB _output:ARGS LIST$(NEXT)
419 LOAD "assets/grays.palt",@32,4096

420 GOSUB _nloutput:ARGS LIST$(NEXT):SWAP SCREEN
421 LOAD SCREEN "assets/rect80.scrt"
422 GOSUB _getkey:SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
423 COPY SCREEN CHR TO @33,0
424 SWAP SCREEN:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"

430 'GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
431 'LOAD PALETTE 0,"assets/grays.palt"
432 'SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
433 'LOAD SCREEN ATTR "assets/rect80.sclr":GOSUB _getkey
434 'SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
435 'COPY SCREEN ATTR TO @33,2048
437 'SWAP SCREEN:GOSUB _assert:ARGS "COMPARE(@32,2048,@33,2048,1024)"

440 GOSUB _nloutput:ARGS LIST$(NEXT)
441 LOAD "assets/rect80.scrp",@32,0
442 GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
444 SCREEN ,,,,0:CLS:LOAD SCREEN "assets/rect80.scrp"
445 GOSUB _getkey:SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
446 COPY SCREEN CHR TO @33,0:V=IN($E0)
447 SWAP SCREEN:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
448 GOSUB _assert:ARGS "(V AND 32)=(PEEK(@32,2048) AND 32)"

450 GOSUB _nloutput:ARGS LIST$(NEXT)
451 LOAD "assets/rect80.scrn",@32,0
452 GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
453 CLS:LOAD SCREEN "assets/rect80.scrn"
454 GOSUB _getkey:SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
456 COPY SCREEN TO @33,0
458 SWAP SCREEN:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,4096)"

490 GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
491 SET FILE ERROR OFF:LOAD SCREEN "nofile80.scrn":SET FILE ERROR ON
492 SWAP SCREEN:GOSUB _assert:ARGS "ERR=50"

500 GOSUB _nloutput:ARGS LIST$(NEXT):SWAP SCREEN
501 SAVE SCREEN "work/save80.scrn"
502 GOSUB _assert:ARGS "FILELEN(`work/save80.scrn`)=4096"
503 SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
504 FILL BYTES @32,0,16384,0:LOAD "work/save80.scrn",@32,0
505 SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
506 RESET PALETTE 0:SCREEN ,,,,0:CLS:LOAD SCREEN "work/save80.scrn"
507 GOSUB _getkey:SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
508 COPY SCREEN TO @33,0
510 SWAP SCREEN:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
518 DEL "work/save80.scrn"

520 GOSUB _nloutput:ARGS LIST$(NEXT):SWAP SCREEN
521 SAVE SCREEN "work/save80.scrp",PALETTE
522 GOSUB _assert:ARGS "FILELEN(`work/save80.scrp`)=4128"
523 SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
524 FILL BYTES @32,0,16384,0:LOAD "work/save80.scrp",@32,0
525 SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
526 RESET PALETTE 0:SCREEN ,,,,0:CLS:LOAD SCREEN "work/save80.scrp"
527 GOSUB _getkey:SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
528 COPY SCREEN TO @33,0:P$=GETPALETTE$(0)
530 SWAP SCREEN:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
532 GOSUB _assert:ARGS "P$=PEEK$(@32,4096,32)"
538 DEL "work/save80.scrp"

540 GOSUB _nloutput:ARGS LIST$(NEXT):SWAP SCREEN
541 SAVE SCREEN "work/save80.scrm",BORDERMAP
542 GOSUB _assert:ARGS "FILELEN(`work/save80.scrm`)=4097"
543 SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
544 FILL BYTES @32,0,16384,0:LOAD "work/save80.scrm",@32,0
545 SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
546 RESET PALETTE 0:SCREEN ,,,,0:CLS:LOAD SCREEN "work/save80.scrm"
547 GOSUB _getkey:SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
548 COPY SCREEN TO @33,0:V=IN($E0)
550 SWAP SCREEN:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
554 GOSUB _assert:ARGS "(V AND 32)=(PEEK(@32,4128) AND 32)"
558 DEL "work/save80.scrm"

560 GOSUB _nloutput:ARGS LIST$(NEXT):SWAP SCREEN
561 SAVE SCREEN "work/save80.scrb",PALETTE,BORDERMAP
562 GOSUB _assert:ARGS "FILELEN(`work/save80.scrb`)=4129"
563 SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
564 FILL BYTES @32,0,16384,0:LOAD "work/save80.scrb",@32,0
565 SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
566 RESET PALETTE 0:SCREEN ,,,,0:CLS:LOAD SCREEN "work/save80.scrb"
567 GOSUB _getkey:SWAP SCREEN:GOSUB _output:ARGS LIST$(NEXT):SWAP SCREEN
568 COPY SCREEN TO @33,0:P$=GETPALETTE$(0):V=IN($E0)
570 SWAP SCREEN:GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,2048)"
572 GOSUB _assert:ARGS "P$=PEEK$(@32,4096,32)"
574 GOSUB _assert:ARGS "(V AND 32)=(PEEK(@32,4128) AND 32)"
578 DEL "work/save80.scrb"


700 GOSUB _nloutput:ARGS "Invalid Screen Files"
701 FOR I=1 TO 8:READ S:F$="work/badsize%%.scrn" % (S)
702 SAVE F$,@32,0,S
703 GOSUB _outquoted:ARGS "LOAD SCREEN '%%'" % (F$)
704 SET FILE ERROR OFF:LOAD SCREEN F$:SET FILE ERROR ON
705 GOSUB _assert:ARGS "ERR=49"
706 DEL F$
707 NEXT
708 DATA 1,1023,1025,2047,2050,4095,4098,4130
