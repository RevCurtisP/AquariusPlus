100 REM CALL and USR
110 QG$="cv"
120 IF FRE(2)<>$BEFF THEN PRINT "Must be run from au.baq":END
130 GOSUB _init

200 GOSUB _title:ARGS "CALL"
210 LOAD "assets/call-test.bin",$BF00

220 GOSUB _output:ARGS LIST$(NEXT)
221 POKE $37E8,$"000000000000"
222 GOSUB _output:ARGS LIST$(NEXT)
223 CALL $BF00
225 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`FAFBFCFDFEFF`"

230 GOSUB _output:ARGS LIST$(NEXT)
231 POKE $37E8,$"000000000000"
232 GOSUB _output:ARGS LIST$(NEXT)
233 CALL $BF03 ARGS $0201
235 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`FAFBFCFD0102`"

240 GOSUB _output:ARGS LIST$(NEXT)
241 POKE $37E8,$"000000000000"
242 GOSUB _output:ARGS LIST$(NEXT)
243 CALL $BF06 ARGS $0403,$0201
245 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`FAFB01020304`"

250 GOSUB _output:ARGS LIST$(NEXT)
251 POKE $37E8,$"000000000000"
252 GOSUB _output:ARGS LIST$(NEXT)
253 CALL $BF09 ARGS $0605,$0403,$0201
255 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`010203040506`"

300 GOSUB _title:ARGS "CALL paged"
310 LOAD "assets/call-paged.bin",@32,0

320 GOSUB _output:ARGS LIST$(NEXT)
321 POKE $37E8,$"000000000000"
322 GOSUB _output:ARGS LIST$(NEXT)
323 CALL @32,0
325 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`FAFBFCFDFEFF`"

330 GOSUB _output:ARGS LIST$(NEXT)
331 POKE $37E8,$"000000000000"
332 GOSUB _output:ARGS LIST$(NEXT)
333 CALL !3 ARGS $0201
335 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`FAFBFCFD0102`"

340 GOSUB _output:ARGS LIST$(NEXT)
341 POKE $37E8,$"000000000000"
342 GOSUB _output:ARGS LIST$(NEXT)
343 CALL @32,6 ARGS $0403,$0201
345 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`FAFB01020304`"

350 GOSUB _output:ARGS LIST$(NEXT)
351 POKE $37E8,$"000000000000"
352 GOSUB _output:ARGS LIST$(NEXT)
353 CALL !9 ARGS $0605,$0403,$0201
355 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`010203040506`"

400 GOSUB _title:ARGS "USR()"
405 RESET USRDEF

410 GOSUB _output:ARGS LIST$(NEXT)
411 POKE $37E8,$"000000000000"
414 GOSUB _assert:ARGS "USR($BF00)=4660"
416 GOSUB _assert:ARGS "PEEK$($37E8,6)=$`FAFBFCFDFEFF`"

