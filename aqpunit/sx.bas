100 REM Test Save and Load Extensions

110 QG$="tf"
120 GOSUB _init

200 GOSUB _title:ARGS "SAVE and LOAD Extensions"
202 SET FILE ERROR OFF
204 WD$="work":MKDIR wd$
208 SET FILE ERROR ON

210 GOSUB _title:ARGS "LOAD/SAVE 1bpp bitmap"
213 FILL BYTE @20,0,16384,$5A:FILL BYTE @32,0,32768,0:SET PALETTE 1 TO STRING$(32,0)

214 GOSUB _nloutput:ARGS "Pixel data only"
215 GOSUB _output:ARGS LIST$(NEXT)
216 LOAD BITMAP "assets/worldmap.bmpp":LOAD "assets/worldmap.bmp1",@32,0
217 GOSUB _assert:ARGS "COMPARE(@20,0,@32,0,8000)"
218 GOSUB _assert:ARGS "PEEK(@20,8000)=$5A"

220 GOSUB _nloutput:ARGS "Colormap only"
221 GOSUB _output:ARGS LIST$(NEXT)
222 LOAD COLORMAP "assets/worldmap.cmap"
223 GOSUB _assert:ARGS "COMPARE(@20,8192,@32,8000,1000)"
224 GOSUB _assert:ARGS "PEEK(@20,9192)=$5A"

226 GOSUB _nloutput:ARGS "Palette"
227 GOSUB _output:ARGS LIST$(NEXT)
228 LOAD PALETTE 1,"assets/worldmap.palt"
229 GOSUB _assert:ARGS "GETPALETTE$(1)=PEEK$(@32,9000,32)"

230 GOSUB _nloutput:ARGS "Pixel data, colormap, and palette"
231 SCREEN 0,2
232 GOSUB _output:ARGS LIST$(NEXT)
233 SAVE BITMAP "work/savebitmap.bmp1"
234 GOSUB _getkey:SCREEN 3,0

243 FILL BYTE @20,0,16384,$5A:SET PALETTE 1 TO STRING$(32,0)

244 GOSUB _nloutput:ARGS "Pixel data and Colormap only"
245 GOSUB _output:ARGS LIST$(NEXT)
246 LOAD BITMAP "assets/worldmap.bmpc":LOAD "assets/worldmap.bmpc",@32,0
247 GOSUB _assert:ARGS "COMPARE(@20,0,@32,0,8000)"
248 GOSUB _assert:ARGS "PEEK(@20,9192)=$5A"
249 GOSUB _assert:ARGS "COMPARE(@20,8192,@32,8000,1000)"

252 FILL BYTE @20,0,16384,$5A:SET PALETTE 1 TO STRING$(32,0)

253 GOSUB _nloutput:ARGS "Pixel data, Colormap, and Palette"
254 GOSUB _output:ARGS LIST$(NEXT)
255 LOAD BITMAP "work/savebitmap.bmp1":LOAD "work/savebitmap.bmp1",@32,0
256 GOSUB _assert:ARGS "COMPARE(@20,0,@32,0,8000)"
257 GOSUB _assert:ARGS "PEEK(@20,9192)=$5A"
258 GOSUB _assert:ARGS "GETPALETTE$(1)=PEEK$(@32,9000,32)"
259 DEL "work/savebitmap.bmp1"

260 FILL BYTE @20,0,16384,$5A:SET PALETTE 1 TO STRING$(32,0)

261 GOSUB _nloutput:ARGS "Legacy Bitmap"
262 GOSUB _output:ARGS LIST$(NEXT)
263 LOAD BITMAP "assets/celtic.bmp":LOAD "assets/celtic.bmp",@32,0
264 SCREEN 0,2:GOSUB _getkey:SCREEN 3,0
265 GOSUB _assert:ARGS "COMPARE(@20,0,@32,0,8000)"
266 GOSUB _assert:ARGS "PEEK$(@20,8000,192)=STRING$(192,$5A)"
267 GOSUB _assert:ARGS "GETPALETTE$(1)=PEEK$(@32,8000,32)"
268 GOSUB _assert:ARGS "COMPARE(@20,8192,@32,8192,1000)"
269 GOSUB _assert:ARGS "PEEK(@20,9192)=$5A"

270 GOSUB _nloutput:ARGS "Invalid Bitmap Files":RESTORE 278
271 FOR I=1 TO 8:READ S:F$="work/badsize%%.bmp" % (S)
272 SAVE F$,@20,0,S
273 GOSUB _outquoted:ARGS "LOAD BITMAP '%%'" % (F$)
274 SET FILE ERROR OFF:LOAD BITMAP F$:SET FILE ERROR ON
275 GOSUB _assert:ARGS "ERR=49"
276 DEL F$
277 NEXT
278 DATA 7999,8001,8999,9001,9031,9033,9191,9193

300 GOSUB _title:ARGS "LOAD/SAVE 4bpp bitmap"
302 GOSUB _output:ARGS LIST$(NEXT)
303 FILL BYTE @20,0,16384,$5A:FILL BYTE @32,0,32768,0:SET PALETTE 1 TO STRING$(32,0)
304 GOSUB _output:ARGS LIST$(NEXT)
305 LOAD "assets/riskmap.bmp4",@32,0:LOAD BITMAP "assets/riskmap.bmp4"
306 SCREEN 0,3
307 GOSUB _output:ARGS LIST$(NEXT)
308 SAVE BITMAP "work/savebitmap.bmp4"
309 GOSUB _getkey:SCREEN 3,0

310 GOSUB _assert:ARGS "COMPARE(@20,0,@32,0,16000)"
313 GOSUB _assert:ARGS "PEEK(@20,16000)=$5A"
314 GOSUB _assert:ARGS "GETPALETTE$(1)=PEEK$(@32,16000,32)"
316 GOSUB _output:ARGS LIST$(NEXT)
317 LOAD "work/savebitmap.bmp4",@33,0
318 GOSUB _assert:ARGS "COMPARE(@32,0,@33,0,16032)"
319 DEL "work/savebitmap.bmp4"

320 GOSUB _output:ARGS LIST$(NEXT)
321 SET FILE ERROR OFF:LOAD BITMAP "nofile.bmp":SET FILE ERROR ON
322 GOSUB _assert:ARGS "ERR=50"

410 GOSUB _title:ARGS "LOAD/SAVE CHRSET"
412 GOSUB _output:ARGS LIST$(NEXT)
413 LOAD "assets/linedraw.char",@32,0:USE CHRSET "assets/linedraw.char"
414 GOSUB _assert:ARGS "COMPARE(@54,$3800,@32,0,2048)"
415 GOSUB _output:ARGS LIST$(NEXT)
416 LOAD CHRSET "assets/seraphim.char":LOAD "assets/seraphim.char",@33,0
417 GOSUB _assert:ARGS "COMPARE(@54,$3800,@32,0,256)"
418 GOSUB _assert:ARGS "COMPARE(@54,$3900,@33,0,768)"
419 GOSUB _assert:ARGS "COMPARE(@54,$3C00,@32,$400,1024)"
420 GOSUB _output:ARGS LIST$(NEXT)
421 LOAD CHRSET "assets/arabic.char":LOAD "assets/arabic.char",@34,0
422 GOSUB _assert:ARGS "COMPARE(@54,$3800,@32,0,256)"
423 GOSUB _assert:ARGS "COMPARE(@54,$3900,@33,0,768)"
424 GOSUB _assert:ARGS "COMPARE(@54,$3C00,@34,0,1024)"
430 GOSUB _output:ARGS LIST$(NEXT)
431 USE CHRSET 1:SAVE CHRSET "work/savechrset.char"
432 GOSUB _output:ARGS LIST$(NEXT)
433 LOAD "work/savechrset.char",@35,0
434 GOSUB _assert:ARGS "COMPARE(@54,$3800,@35,0,2048)"
436 USE CHRSET 0
438 DEL "work/savechrset.char"

440 GOSUB _output:ARGS LIST$(NEXT)
441 SET FILE ERROR OFF:LOAD CHRSET "nofile.chr":SET FILE ERROR ON
442 GOSUB _assert:ARGS "ERR=50"

450 GOSUB _title:ARGS "LOAD/SAVE FNKEYS"
452 GOSUB _output:ARGS LIST$(NEXT)
453 SAVE FNKEYS "work/fnkeysave.fkey":LOAD "work/fnkeysave.fkey",@32,0
455 GOSUB _assert:ARGS "COMPARE(@32,0,@54,$200,512)"
458 DEL "work/fnkeysave.fkey"

465 GOSUB _output:ARGS LIST$(NEXT)
466 SET FILE ERROR OFF:LOAD FNKEYS "nofnkeys.fkey":SET FILE ERROR ON
467 GOSUB _assert:ARGS "ERR=50"

470 GOSUB _title:ARGS "LOAD/SAVE PALETTE"
472 GOSUB _output:ARGS LIST$(NEXT)
473 FOR P=0 TO 3:SAVE PALETTE P,"palette%%.palt" % (P):NEXT
474 GOSUB _output:ARGS LIST$(NEXT)
475 FOR P=0 TO 3:LOAD "palette%%.palt" % (P),@32,P*32:NEXT
476 FOR P=0 TO 3
477 GOSUB _assert:ARGS "PEEK$(@32,P*32,32)=GETPALETTE$(P)"
478 NEXT
479 FOR P=0 TO 3:DEL "palette%%.palt" % (P):NEXT

485 GOSUB _output:ARGS LIST$(NEXT)
486 SET FILE ERROR OFF:LOAD FNKEYS "nopalette.palt":SET FILE ERROR ON
487 GOSUB _assert:ARGS "ERR=50"

500 GOSUB _title:ARGS "LOAD PT3"
501 FILL BYTE @55,$0A00,$3600,0
502 GOSUB _output:ARGS LIST$(NEXT)
503 LOAD PT3 "assets/510_32.pt3"
504 GOSUB _assert:ARGS "PEEK$(@55,$0A00,17)=`Vortex Tracker II`"

506 GOSUB _output:ARGS LIST$(NEXT):SET FILE ERROR OFF
507 LOAD PT3 "nofile.pt3"
508 SET FILE ERROR ON
509 GOSUB _assert:ARGS "ERR=50"

600 GOSUB _title:ARGS "LOAD TILESET"
601 GOSUB _nloutput:ARGS LIST$(NEXT)
602 FILL BYTE @20,0,16384,$5A
603 GOSUB _output:ARGS LIST$(NEXT)
604 LOAD "assets/tiles.tset",@32,0
605 GOSUB _output:ARGS LIST$(NEXT)
606 LOAD TILESET "assets/tiles.tset"
608 GOSUB _assert:ARGS "COMPARE(@20,0,@32,0,3936)"
609 GOSUB _assert:ARGS "PEEK(@20,3936)=$5A"

610 GOSUB _nloutput:ARGS LIST$(NEXT):SET FILE ERROR OFF
611 LOAD TILESET "nofile.tset"
612 SET FILE ERROR OFF
613 GOSUB _assert:ARGS "ERR=50"

620 GOSUB _nloutput:ARGS LIST$(NEXT)
621 LOAD TILESET INDEX 128,"assets/tiles.tset"
622 GOSUB _assert:ARGS "COMPARE(@20,4096,@32,0,3936)"
623 GOSUB _assert:ARGS "PEEK(@20,4095)=$5A"
624 GOSUB _assert:ARGS "PEEK(@20,8032)=$5A"

626 GOSUB _nloutput:ARGS LIST$(NEXT):SET FILE ERROR OFF
627 LOAD TILESET INDEX 390,"assets/tiles.tset"
628 SET FILE ERROR OFF
629 GOSUB _assert:ARGS "ERR=49"

630 GOSUB _nloutput:ARGS LIST$(NEXT)
631 FILL BYTE @20,0,16384,$5A
632 GOSUB _output:ARGS LIST$(NEXT)
633 F=TILEOFFSET
634 GOSUB _output:ARGS LIST$(NEXT)
635 LOAD TILESET OFFSET 3,"assets/tiles.tset"
636 GOSUB _assert:ARGS "F=128"
637 GOSUB _assert:ARGS "COMPARE(@20,4192,@32,0,3936)"
638 GOSUB _assert:ARGS "PEEK(@20,4191)=$5A"
639 GOSUB _assert:ARGS "PEEK(@20,8128)=$5A"

640 GOSUB _nloutput:ARGS LIST$(NEXT)
641 FILL BYTE @20,0,16384,$5A
642 GOSUB _output:ARGS LIST$(NEXT)
643 SCREEN,2:F=TILEOFFSET
644 GOSUB _output:ARGS LIST$(NEXT)
645 LOAD TILESET OFFSET 1,"assets/tiles.tset":SCREEN ,0
646 GOSUB _assert:ARGS "F=320"
647 GOSUB _assert:ARGS "COMPARE(@20,10272,@32,0,3936)"
648 GOSUB _assert:ARGS "PEEK(@20,10271)=$5A"
649 GOSUB _assert:ARGS "PEEK(@20,14208)=$5A"
  
650 GOSUB _nloutput:ARGS LIST$(NEXT)
653 SCREEN,3:F=TILEOFFSET
654 GOSUB _output:ARGS LIST$(NEXT)
655 LOAD TILESET OFFSET 0,"assets/tiles12.tset":SCREEN ,0
656 GOSUB _assert:ARGS "F=500"
657 GOSUB _assert:ARGS "COMPARE(@20,16000,@32,0,384)"
658 GOSUB _assert:ARGS "PEEK(@20,15999)=$5A"

660 GOSUB _nloutput:ARGS LIST$(NEXT):SET FILE ERROR OFF
661 SCREEN,3:LOAD TILESET OFFSET 0,"assets/tiles.tset":SCREEN ,0
662 SET FILE ERROR OFF
663 GOSUB _assert:ARGS "ERR=49"


690 goto _finish

700 GOSUB _title:ARGS "LOAD TILEMAP"
701 GOSUB _output:ARGS LIST$(NEXT)
702 FILL BYTE @20,0,16384,$5A:FILL BYTE @32,0,16384,$5A
703 GOSUB _output:ARGS LIST$(NEXT)
704 LOAD "assets/64x32.tmap",@32,0
705 GOSUB _output:ARGS LIST$(NEXT)
706 LOAD TILEMAP "assets/64x32.tmap"
708 GOSUB _assert:ARGS "COMPARE(@20,0,@32,0,4096)"


710 GOSUB _nloutput:ARGS LIST$(NEXT)
711 LOAD "assets/64x32.tmap",@33,0
712 GOSUB _output:ARGS LIST$(NEXT)
713 SAVE TILEMAP "work/savetilemap.tmap"
714 FILL BYTE @20,0,16384,$5A
715 GOSUB _output:ARGS LIST$(NEXT)
716 LOAD TILEMAP "work/savetilemap.tmap"
720 GOSUB _assert:ARGS "COMPARE(@20,0,@33,0,4096)"
721 GOSUB _assert:ARGS "PEEK(@20,4096)=$5A"

732 F=1:FOR L=3200 TO 4096 STEP 128:F=-F
733 GOSUB _nloutput:ARGS "L=%%:F=%%" % (L,F)
734 GOSUB _output:ARGS LIST$(NEXT)
735 SAVE "work/savetilemap.tmap",@33,0,L
736 GOSUB _output:ARGS LIST$(NEXT)
737 FILL BYTE @20,0,16384,$5A
738 GOSUB _output:ARGS LIST$(NEXT)
739 LOAD TILEMAP "work/savetilemap.tmap"
740 GOSUB _assert:ARGS "COMPARE(@20,0,@32,0,L)"
741 GOSUB _assert:ARGS "PEEK(@20,L)=$5A"
742 GOSUB _output:ARGS LIST$(NEXT)
743 SAVE "work/savetilemap.tmap",@33,0,L+F
744 GOSUB _output:ARGS LIST$(NEXT)
745 SET FILE ERROR OFF:LOAD TILEMAP "work/savetilemap.tmap":SET FILE ERROR ON
746 GOSUB _assert:ARGS "ERR=49"
748 NEXT L
749 DEL "work/savetilemap.tmap"

760 GOSUB _nloutput:ARGS LIST$(NEXT)
761 FILL BYTE @20,0,16384,$5A:FILL BYTE @32,0,16384,$5A
762 LOAD "assets/40x25.tmap",@32,0
763 GOSUB _output:ARGS LIST$(NEXT)
764 GOSUB _output:ARGS LIST$(NEXT)
765 LOAD TILEMAP "assets/40x25.tmap"
766 V=0:FOR A=0 TO 2000 STEP 80
767 GOSUB _assert:ARGS "COMPARE(@20,%%,@32,%%,80)" % (V,A)
768 V=V+128:NEXT

