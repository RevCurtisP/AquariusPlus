100 REM Test TRIM and PAD functions
110 QG$="ts"
120 GOSUB _INIT
190 GOTO 500
200 GOSUB _TITLE:ARGS "String Trim Functions"
201 PRINT LIST$(NEXT)
202 C$="@":S$="<=>":D$="@@@123@@@":D$(0)="@@@@@@":D$(1)="<=>X=Y<=>"
210 GOSUB _TITLE:ARGS "TRIM$"
211 GOSUB _ASSERT:ARGS "TRIM$(`   123   `)=`123`)"
212 GOSUB _ASSERT:ARGS "TRIM$(\` \t1 2 3   \r\n`)=`1 2 3`"
213 GOSUB _ASSERT:ARGS "TRIM$(``)=``"
214 GOSUB _ASSERT:ARGS "TRIM$(`      `)=``"
215 GOSUB _ASSERT:ARGS "TRIM$(D$,`@`)=`123`"
216 GOSUB _ASSERT:ARGS "TRIM$(D$(0),C$)=``"
217 GOSUB _ASSERT:ARGS "TRIM$(`#*#123#*#`,`*#`)=`123`"
218 GOSUB _ASSERT:ARGS "TRIM$(D$(1),S$)=`X=Y`)"
230 GOSUB _TITLE:ARGS "TRIML$"
231 GOSUB _ASSERT:ARGS "TRIML$(`   123   `)=`123   `"
232 GOSUB _ASSERT:ARGS "TRIML$(\` \t1 2 3   \r\n`)=\`1 2 3   \r\n``"
233 GOSUB _ASSERT:ARGS "TRIM$(``)=``"
234 GOSUB _ASSERT:ARGS "TRIML$(`      `)=``"
235 GOSUB _ASSERT:ARGS "TRIML$(D$,`@`)=`123@@@`"
236 GOSUB _ASSERT:ARGS "TRIML$(D$(0),C$)=``"
237 GOSUB _ASSERT:ARGS "TRIML$(`*#*#123#*#`,`#*`)=`123#*#`"
238 GOSUB _ASSERT:ARGS "TRIML$(D$(1),S$)=`X=Y<=>`)"
250 GOSUB _TITLE:ARGS "TRIMR$"
251 GOSUB _ASSERT:ARGS "TRIMR$(`   123   `)=`   123`"
252 GOSUB _ASSERT:ARGS "TRIMR$(\`1 2 3   \r\n`)=\`1 2 3`"
253 GOSUB _ASSERT:ARGS "TRIM$(``)=``"
254 GOSUB _ASSERT:ARGS "TRIMR$(`      `)=``"
255 GOSUB _ASSERT:ARGS "TRIMR$(D$,C$)=`@@@123`"
256 GOSUB _ASSERT:ARGS "TRIMR$(D$(0),`@`)=``"
257 GOSUB _ASSERT:ARGS "TRIMR$(`#*#123*#*`,`#*`)=`#*#123`"
258 GOSUB _ASSERT:ARGS "TRIMR$(D$(1),S$)=`<=>X=Y`)"
300 GOSUB _TITLE:ARGS "Filespec Trim and Extract Functions"
301 PRINT LIST$(NEXT)
302 F$="no_ext":F1$="/no_ext":F2 $="a/no_ext":F$(0)="a/b/file.tmp"
310 GOSUB _TITLE:ARGS "FILEEXT$"
311 GOSUB _ASSERT:ARGS "FILEEXT$(`file.ext`)=`ext`"
312 GOSUB _ASSERT:ARGS "FILEEXT$(F$)=``"
313 GOSUB _ASSERT:ARGS "FILEEXT$(F$(0))=`tmp`"
330 GOSUB _TITLE:ARGS "FILEDIR$"
331 GOSUB _ASSERT: ARGS "FILEDIR$(`file.ext`)=``"
332 GOSUB _ASSERT: ARGS "FILEDIR$(F1$)=`/`"
333 GOSUB _ASSERT: ARGS "FILEDIR$(F$(0))=`a/b/`"
334 GOSUB _ASSERT: ARGS "FILEDIR$(`a/`)=`a/`"
335 GOSUB _ASSERT: ARGS "FILEDIR$(`/a/b/`)=`/a/b/`"
350 GOSUB _TITLE:ARGS "TRIMDIR$"
353 GOSUB _ASSERT: ARGS "TRIMDIR$(`file.ext`)=`file.ext`"
354 GOSUB _ASSERT: ARGS "TRIMDIR$(F2$)=`no_ext`"
355 GOSUB _ASSERT: ARGS "TRIMDIR$(F$(0))=`file.tmp`"
356 GOSUB _ASSERT: ARGS "TRIMDIR$(``)=``"
357 GOSUB _ASSERT: ARGS "TRIMDIR$(`a/`)=``"
358 GOSUB _ASSERT: ARGS "TRIMDIR$(`/a/b/`)=``"
370 GOSUB _TITLE:ARGS "TRIMEXT$"
373 GOSUB _ASSERT: ARGS "TRIMEXT$(`file.ext`)=`file`"
374 GOSUB _ASSERT: ARGS "TRIMEXT$(F$)=`no_ext`"
375 GOSUB _ASSERT: ARGS "TRIMEXT$(F$(0))=`a/b/file`"
376 GOSUB _ABVSSERT: ARGS "TRIMEXT$(``)=``"
500 GOSUB _TITLE:ARGS("PAD$")
501 GOSUB _ASSERT:ARGS "PAD$(`xyz`,9)=`xyz      `"
502 GOSUB _ASSERT:ARGS "PAD$(`xyz`,-10)=`       xyz`"
503 GOSUB _ASSERT:ARGS "PAD$(`xyz`,1)=`x`"
504 GOSUB _ASSERT:ARGS "PAD$(`xyz`,-2)=`yz`"
505 GOSUB _ASSERT:ARGS "PAD$(`xyz`,0)=``"
506 GOSUB _ASSERT:ARGS "PAD$(`xyz`,9,`!`)=`xyz!!!!!!`"
507 GOSUB _ASSERT:ARGS "PAD$(`xyz`,-10,`@`)=`@@@@@@@xyz`"
508 GOSUB _ASSERT:ARGS "PAD$(`xyz`,5,0)=`xyz`+$`0000`"
509 GOSUB _ASSERT:ARGS "PAD$(`xyz`,-6,0)=$`000000`+`xyz`"
510 GOSUB _TITLE:ARGS("PAD$")
511 GOSUB _OUTPUT:ARGS LIST$(NEXT)
512 P$="xyz"
521 GOSUB _ASSERT:ARGS "PAD$(P$,9)=`xyz      `"
522 GOSUB _ASSERT:ARGS "PAD$(P$,-10)=`       xyz`"
523 GOSUB _ASSERT:ARGS "PAD$(P$,1)=`x`"
524 GOSUB _ASSERT:ARGS "PAD$(P$,-2)=`yz`"
525 GOSUB _ASSERT:ARGS "PAD$(P$,0)=``"
526 GOSUB _ASSERT:ARGS "PAD$(P$,9,`!`)=`xyz!!!!!!`"
527 GOSUB _ASSERT:ARGS "PAD$(P$,-10,`@`)=`@@@@@@@xyz`"
528 GOSUB _ASSERT:ARGS "PAD$(P$,5,0)=`xyz`+$`0000`"
529 GOSUB _ASSERT:ARGS "PAD$(P$,-6,0)=$`000000`+`xyz`"
540 GOSUB _TITLE:ARGS("Multiple PAD$")
541 P1$="1":P2$="22":P3$="333":P4$="4444"
542 PD$="`1   22333444`"
543 T1$=PAD$(P1$,3)
544 T2$=PAD$(P2$,-3)
545 T3$=PAD$(P3$,3):PRINT "Start debug":PAUSE
546 T4$=PAD$(P4$,3):PRINT T3$
547 TT$=T1$+T2$+T3$+T4$
548 TS$="T1$+T2$+T3$+T4$"
549 GOSUB _ASSERT:ARGS TS$+"="+PD$
880 _FINISH: GOSUB _OUTNEWLINE
882 IF DEEK($38AF)<>$38B1 THEN GOSUB _ADDERROR:ARGS "Error: hanging temp descriptors"
885 _PASSED: GOSUB _OUTPUT:ARGS "Passed:"+STR$(QR(1))
886 _FAILED: GOSUB _OUTPUT:ARGS "Failed:"+STR$(QR(0))
887 _ERRORS: GOSUB _OUTPUT:ARGS "Errors:"+STR$(QR(2))
888 GOSUB _OUTNEWLINE
890 FOR I=0 TO 2:QA=$BFF8+I*2:DOKE QA,DEEK(QA)+QR(I):NEXT
892 QS$=ARGS$(0)+\" - Passed: %%, Failed: %%, Errors: %%\n" % (QR(1), QR(0), QR(2))
894 APPEND "out/_results.txt",^QS$:IF QU<>0 THEN GOSUB _OUTSCREEN:ARGS QS$
896 IF QC=0 THEN PRINT "Unit Tests Complete":END
897 IF QG THEN RUN QG$+".baq"
898 _THEEND:GOSUB _NLSCREEN:ARGS "F3=Run Again, F4=Run Next":END
900 _INIT:
901 SET FNKEY 3 TO "run "+ARGS$(0)+CHR$(13):SET FNKEY 4 TO "run "+QG$+".baq"+CHR$(13)
902 DIM QR(2),QR$(2):QC=LEN(QG$):SET SPEED 3:SCREEN 3:QZ=FRE("")
904 IF FRE(2)=$BFF6 THEN QX=-1:QG=PEEK($BFF7):QF=-PEEK($BFFE):QU=PEEK($BFFF):IF QU=0 THEN CLS
906 IF QU=2 THEN QF$=TRIMEXT$(ARGS$(0)):QF$="out/"+QF$+".out":SAVE QF$,^QZ$
908 GOSUB _OUTSCREEN:ARGS "Running Tests":QQ$=CHR$(34):QR$(0)="Fail: ":QR$(1)="Pass: ":RETURN
910 _TITLE:GETARGS QT$:GOSUB _OUTNEWLINE:GOSUB _OUTPUT:ARGS "Testing "+QT$
912 IF QU<>0 THEN GOTO _OUTSTRING
914 RETURN
918 _ADDERROR: QR(2)=QR(2)+1:GETARGS QA$:GOSUB _OUTPUT:ARGS QA$:GOTO _FAILCHECK
920 _ASSERT:GETARGS QA$:GOSUB _QUOTES
922 ON ERROR GOTO 926:QV=-EVAL(QA$):ON ERROR GOTO 0
924 GOSUB _OUTPUT:ARGS QR$(QV)+QA$:QR(QV)=QR(QV)+1:GOTO _FAILCHECK
926 GOSUB _OUTPUT:ARGS ERR$+" error in "+QA$:RESUME:ON ERROR GOTO 0:QR(2)=QR(2)+1
928 _FAILCHECK: ON -(QF AND QV-1) GOTO _THEEND:RETURN
940 _ASSERT_ERR:GETARGS QA$,QE:GOSUB _QUOTES
942 ON ERROR GOTO _YES_ERR:QV=EVAL(QA$)
944 _NO_ERR:ON ERROR GOTO 0:GOSUB _OUTPUT:ARGS "No Error in "+QA$:QR(0)=QR(0)+1:GOTO _FAILCHECK
946 _YES_ERR:QV=-(ERR=QE):QR(QV)=QR(QV)+1:GOSUB _OUTPUT:ARGS QR$(QV)+"Error"+STR$(QE)+" in "+QA$
948 RESUME:ON ERROR GOTO 0:GOTO _FAILCHECK
950 _OUTNEWLINE:IF QU=0 THEN PRINT:QL=QL+1:RETURN
952 IF QU=1 THEN LPRINT:RETURN
954 QN$=\"\n":APPEND QF$,^QN$:RETURN
956 _OUTNLQUOTE:GOSUB _OUTNEWLINE
958 _OUTQUOTED:GOSUB _QUOTES:GOTO _OUTPUT:ARGS QU$
960 _OUTPART: GETARGS QU$:ON QU GOTO _OUTPRINTER,_OUTFILE
962 IF QL>20 THEN GOSUB _PAUSE
964 PRINT QU$;:QL=QL+1:RETURN
966 _OUTPRINTER:LPRINT QU$;:RETURN
970 _QUOTES:FOR QI=1 TO LEN(QA$):QC$=QA$[QI]:IF QC$="`" THEN QA$[QI]=QQ$
972 IF QQ THEN PRINT QI;" ";QC$;" ";QA$
974 NEXT:QQ=0:RETURN
976 _NLSCREEN:QU$="":GOSUB _OUTSTRING
977 _OUTSCREEN:GETARGS QU$:GOTO _OUTSTRING
978 _NLOUTPUT:GOSUB _OUTNEWLINE
980 _OUTPUT:GETARGS QU$:ON QU GOTO _OUTPRINTER,_OUTFILE
982 _OUTSTRING:IF QL>20 THEN GOSUB _PAUSE
984 PRINT QU$:QL=QL+1:RETURN
986 _OUTPRINTER:LPRINT QU$:RETURN
988 _OUTFILE:QN$=\"%%\n" % (QU$):APPEND QF$,^QN$:RETURN
992 _PAUSE:IF QU OR QK='c' THEN RETURN
994 PRINT:PRINT "...Press a key...":QL=0:QK=GETKEY:PRINT:RETURN
996 _GETKEY:IF QU=0 AND QK<>'c' THEN QK=GETKEY
998 RETURN
