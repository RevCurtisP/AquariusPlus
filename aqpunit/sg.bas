100 REM Screen Graphics
110 QG$="sj"
130 GOSUB _init

180 SC=40: 'Screen width
181 SS=1.6: 'Cursor X-offset multiplier
182 SE=999: 'Last byte of visible screen/color RAM
183 S3=1023: 'Alternate border character offset
184 S4=1023: 'Alternate border colot offset
185 SL=1000: 'Length of visible screen/color RAM
186 SR=1024: 'Size of Screen/Color RAM

190 ' Extended RAM Usage
191 ' !0000-!2047 - 2048 Spaces
192 ' !2048-!4095 - 2048 $06
193 ' !4096-!6144 - 2048 $7F

200 GOSUB _title:ARGS "Screen Graphics"
201 GOSUB _output:ARGS LIST$(NEXT)
202 FILL BYTES !0,2048,' ':FILL BYTES !2048,2048,6:FILL BYTES !4096,2048,$71
203 GOSUB _output:ARGS LIST$(NEXT)
204 SF=SR-SL:SF$=STRING$(SF,$FE):CF$=STRING$(SF,$EF):
205 GOSUB _output:ARGS LIST$(NEXT)
206 DS$=STRING$(SF):DC$=STRING$(SF,$06)

210 _main:
212 GOSUB _title:ARGS "%%-column mode" % (SC)
214 GOSUB _init_screen

220 GOSUB _main_screen:GOSUB _title:ARGS "CHR$(11)"
221 L1$=LIST$(NEXT):GOSUB _work_screen
222 SCREEN ,,,,1:SET COLOR 7,1:SET CURSOR OFF:POKE SCREEN SL,SF$:POKE COLOR SL,SF$
223 L2$=LIST$(NEXT)
224 PRINT CHR$(11);:COPY SCREEN TO !8192:GC=GETCOLOR:GS=SCREEN:GU=GETCURSOR

230 GOSUB _main_screen:GOSUB _output:ARGS L1$:GOSUB _output:ARGS L2$
231 POKE !SC+1,$7F:CL=1024:IF SC=80 THEN CL=2000
232 GOSUB _assert:ARGS "COMPARE(!8192,!0,%%)" % (CL): 'Screen RAM
233 GOSUB _assert:ARGS "COMPARE(!%%,!2048,%%)" % (SR+8192,CL): 'Color RAM
234 IF SC=80 THEN GOSUB _assert:ARGS "PEEK$(!%%,%%)=SF$" % (8192+SL,SF)
235 IF SC=80 THEN GOSUB _assert:ARGS "PEEK$(!%%,%%)=SF$" % (8192+SR+SL,SF)
236 GOSUB _assert:ARGS "GC=-1": 'Color printing disabled
237 GOSUB _assert:ARGS "BIT(GS,5)=0": 'Map border char off
238 GOSUB _assert:ARGS "GU=-1": 'Cursor enabled
239 GOSUB _outnewline:POKE !SC+1,' '


240 GOSUB _title:ARGS "CLS"
242 FOR B=0 TO 1:FOR C=0 TO 1:FOR U=0 TO 1
246 GOSUB _work_screen

250 SCREEN ,,,,B:L1$="SCREEN,,,,%%" % (B)
251 IF C=0 THEN SET COLOR OFF:CC=-1:L1$=L1$+":SET COLOR OFF"
252 IF C THEN SET COLOR 7,1:CC=$71:L1$=L1$+":SET COLOR 7,1"
253 IF U=0 THEN SET CURSOR OFF:L1$=L1$+":SET CURSOR OFF"
254 IF U THEN SET CURSOR ON:L1$=L1$+":SET CURSOR ON"
255 L2$=LIST$(NEXT)
256 POKE SCREEN SL,SF$:POKE COLOR SL,SF$

261 L3$=LIST$(NEXT)
262 CLS:COPY SCREEN TO !8192:GC=GETCOLOR:GS=SCREEN:GU=GETCURSOR
265 GOSUB _getkey:GOSUB _main_screen:CO=2048*(C+1)
268 GOSUB _output:ARGS L1$:GOSUB _output:ARGS L2$:GOSUB _output:ARGS L3$

271 GOSUB _assert:ARGS "(PEEK(!%%)=' ')" % (SC+1)
272 GOSUB _assert:ARGS "COMPARE(!8192,!0,%%)" % (SL): 'Screen RAM
273 GOSUB _assert:ARGS "PEEK$(!%%,%%)=SF$" % (8192+SL,SF)
274 GOSUB _assert:ARGS "COMPARE(!%%,!%%,%%)" % (8192+SR,CO,SL)
275 GOSUB _assert:ARGS "PEEK$(!%%,%%)=SF$" % (8192+SR+SL,SF)
276 GOSUB _assert:ARGS "GC=%%" % (CC): 'Color printing disabled
277 GOSUB _assert:ARGS "BIT(GS,5)=%%" % (-B): 'Map border char off
278 GOSUB _assert:ARGS "GU=%%" % (-U): 'Cursor enabled
279 GOSUB _outnewline

290 NEXT U:NEXT C:NEXT B

301 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
302 SET COLOR OFF:CLS:POKE SCREEN SE+1,DS$:POKE COLOR SE+1,DC$

310 GOSUB _main_screen:GOSUB _title:ARGS "FILL SCREEN"
311 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
312 FILL SCREEN CHR '@'
313 GOSUB _getkey:L$=LIST$(NEXT)
314 PB=PEEKSCREEN(0):PE=PEEKSCREEN(SE):PN=PEEKSCREEN(SE+1)
315 GOSUB _main_screen:GOSUB _output:ARGS L$
316 GOSUB _assert:ARGS "PB='@'"
317 GOSUB _assert:ARGS "PE='@'"
318 GOSUB _assert:ARGS "PN=' '"

320 GOSUB _title:ARGS "SET BORDER and GETBORDER"
321 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
322 SCREEN ,,,,0:SET BORDER CHR '*' COLOR 7,0
324 GOSUB _getkey:L$=LIST$(NEXT)
325 B1=GETBORDERCHR:B2=GETBORDERCOLOR:P1=PEEKSCREEN(0):P2=PEEKCOLOR(0)
328 GOSUB _main_screen:GOSUB _output:ARGS L$

330 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
331 SCREEN ,,,,1:SET BORDER CHR "+"
332 GOSUB _main_screen:GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
333 SET BORDER COLOR 15,7
334 GOSUB _getkey:L$=LIST$(NEXT)
335 B3=GETBORDERCHR:B4=GETBORDERCOLOR:P3=PEEKSCREEN(S3):P4=PEEKCOLOR(S4)
338 GOSUB _main_screen:GOSUB _output:ARGS L$

340 GOSUB _assert:ARGS "B3='+'"
341 GOSUB _assert:ARGS "B4=$F7"
342 GOSUB _assert:ARGS "P3='+'"
343 GOSUB _assert:ARGS "P4=$F7"

345 GOSUB _assert:ARGS "B1='*'"
346 GOSUB _assert:ARGS "B2=$70"
347 GOSUB _assert:ARGS "P1='*'"
348 GOSUB _assert:ARGS "P2=$70"

350 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
351 SCREEN ,,,,0:RESET BORDER
354 GOSUB _getkey:L$=LIST$(NEXT)
355 B1=GETBORDERCHR:B2=GETBORDERCOLOR:P1=PEEKSCREEN(0):P2=PEEKCOLOR(0)
358 GOSUB _main_screen:GOSUB _output:ARGS L$

360 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
361 SCREEN ,,,,1:CLS:SET BORDER CHR '+' COLOR 15,7
364 GOSUB _getkey:L$=LIST$(NEXT)
365 B3=GETBORDERCHR:B4=GETBORDERCOLOR:P3=PEEKSCREEN(S3):P4=PEEKCOLOR(S4)
368 GOSUB _main_screen:GOSUB _output:ARGS L$

370 GOSUB _assert:ARGS "B3='+'"
371 GOSUB _assert:ARGS "B4=$F7"
372 GOSUB _assert:ARGS "P3='+'"
373 GOSUB _assert:ARGS "P4=$F7"

375 GOSUB _assert:ARGS "B1=' '"
376 GOSUB _assert:ARGS "B2=$06"
377 GOSUB _assert:ARGS "P1=' '"
378 GOSUB _assert:ARGS "P2=$06"

400 GOSUB _title:ARGS "SET COLOR, GETCOLOR"
401 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
402 CLS:SET COLOR 7,1:C1=GETCOLOR:P1=PEEK COLOR(SC+1)
403 GOSUB _main_screen: GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
404 PRINT "*";:P2=PEEK COLOR(SC+1):P3=PEEK COLOR(SC+2)
405 GOSUB _main_screen:GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
406 SET COLOR OFF:C4=GETCOLOR:P4=PEEK COLOR(SC+2)
407 GOSUB _main_screen: GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
408 PRINT "*";:P5=PEEK COLOR(SC+2):P6=PEEK COLOR(SC+3)
409 GOSUB _main_screen

411 GOSUB _assert:ARGS "C1=$71"
412 GOSUB _assert:ARGS "P1=$06"
413 GOSUB _assert:ARGS "P2=$71"
414 GOSUB _assert:ARGS "P3=$71"
415 GOSUB _assert:ARGS "C4=-1"
416 GOSUB _assert:ARGS "P4=$71"
417 GOSUB _assert:ARGS "P5=$71"
418 GOSUB _assert:ARGS "P6=$06"

450 GOSUB _title:ARGS "SET CURSOR, GETCURSOR"
451 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
452 CLS:SET CURSOR OFF:C1=GETCURSOR:P1=PEEK SCREEN(SC+1)
453 GOSUB _main_screen:GOSUB _output:ARGS LIST$(NEXT): GOSUB _work_screen
454 SET CURSOR ON:C2=GETCURSOR:P2=PEEK SCREEN(SC+1)
455 GOSUB _main_screen

460 GOSUB _assert:ARGS "C1=0"
462 GOSUB _assert:ARGS "C2=-1"
464 GOSUB _assert:ARGS "P1=' '"
466 GOSUB _assert:ARGS "P2=$7F"

480 GOSUB _title:ARGS "CLEAR CURSOR"
481 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
482 LOCATE 3,1:C3=PEEKSCREEN(SC*2+3)
483 GOSUB _main_screen:GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
484 CLEAR CURSOR:C4=PEEKSCREEN(SC*2+3)
485 GOSUB _getkey:GOSUB _main_screen
487 GOSUB _assert:ARGS "C3=$7F"
488 GOSUB _assert:ARGS "C4=' '"

520 GOSUB _title:ARGS "LOCATE, PRINT @, CURSORX, CURSORY, and CURSOROFFSET"
521 FOR SY=0 TO 23 STEP 2:SX=INT(SY*SS+1)
522 GOSUB _output:ARGS "SX=%% SY=%%" % (SX,SY)
524 GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
525 LOCATE SX,SY:CX=CURSORX:CY=CURSORY:CF=CURSOROFFSET
526 GOSUB _main_screen:GOSUB _output:ARGS LIST$(NEXT):GOSUB _work_screen
527 PRINT @(SX+1,SY+1);:AX=CURSORX:AY=CURSORY:AF=CURSOROFFSET


530 IF Y=23 THEN GOSUB _getkey
531 GOSUB _main_screen
532 GOSUB _assert:ARGS "CX=%%" % (SX)
533 GOSUB _assert:ARGS "CY=%%" % (SY+1)
534 GOSUB _assert:ARGS "CF=%%" % (SY*SC+SC+SX)
535 GOSUB _assert:ARGS "AX=%%" % (SX+1)
536 GOSUB _assert:ARGS "AY=%%" % (SY+2)
537 GOSUB _assert:ARGS "AF=%%" % (SY*SC+SC+SC+SX+1)
539 NEXT

602 'CLS fg,bg
604 'CLS COLOR
610 'GET/PUT SCREEN
638 'RESET SCREEN
650 'STASH/SWAP/RESTORE SCREEN

700 IF SC=80 THEN GOTO _finish
702 SC=80:SS=1.6:SE=1999:S3=2047:S4=2047:SL=2000:SR=2048
704 GOTO _main

710 _init_screen:
712 SET COLOR OFF
714 IF SC=40 THEN SCREEN 1,0,0,0,0:RETURN
716 STASH SCREEN:SCREEN 3,0,0,0,0:RETURN

720 _work_screen
724 IF SC=40 THEN SCREEN 1:RETURN
726 SWAP SCREEN:RETURN

730 _main_screen:
732 IF SC=40 THEN SCREEN 3:RETURN
734 SWAP SCREEN:RETURN
